---
title: "Project Report"
output: 
  html_document:
    code_folding: hide
    toc: true
    toc_float: true
---

```{r setup, message=FALSE, include=FALSE}
library(tidyverse)
library(ggplot2)
library(readr)
library(readxl)
library(patchwork)
library(leaflet)
library(rvest)
library(plotly)
library(gganimate)
library(png)
knitr::opts_chunk$set(
  out.width = "90%"
)
theme_set(theme_minimal() + theme(legend.position = "bottom"))
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_color_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

```{r, include=FALSE}
songs_abuse=read_csv("data/songs_abuse.csv")
genly_billboard=read_csv("data/genly_billboard.csv")
```

<style type="text/css">
</style>
&nbsp;

## Motivation

This project is overall motivated by the current major public health issue in United States: the Illicit drug use. Previous studies showed a relationship between illicit drug use and pop music [[1](https://pubmed.ncbi.nlm.nih.gov/30599351/),[2](https://www.tandfonline.com/doi/full/10.3109/10826084.2012.637433)], indicating that pop music may have a potential encouraging effect on illicit drug use [[3](https://pubmed.ncbi.nlm.nih.gov/18250243/)]. However, these studies are either cross-sectional, or need to be reproduce using more recent data. 
In this study, we will describe the trend of music genre, frequency of illicit drug in the popular music, and the relationship between popular music and illicit drug use during the period of 1999-2019.

&nbsp;

## Questions

The questions for this project are based on the 3 datasets we used which are explained in the next section:

<li>What are the trends of substance use among our interested age group at national level and state level during the period of 1999-2019?</li>
<li>What are the trends of popular music genre and description of substance use in the lyrics during the period of 1999-2019?</li>
<li>Is there any association exist between popular music and substance use during the period of 1999-2019?</li>

&nbsp;

## Data

<li>Popular music data: from [Data on Songs from Billboard 1999-2019](https://www.kaggle.com/danield2255/data-on-songs-from-billboard-19992019).</li>
<li>Illicit drug usage data: from [National Survey on Drug Use and Health (NSDUH) 1999-2019](https://www.datafiles.samhsa.gov/dataset/national-survey-drug-use-and-health-2019-nsduh-2019-ds0001)</li>
<li>Substance word list: from [Addiction Center.com](https://www.addictioncenter.com/). They are [Drug Street Names](https://www.addictioncenter.com/drugs/drug-street-names/) and [Drug And Alcohol Slang Terms](https://www.addictioncenter.com/drugs/drug-alcohol-slang/).</li>
### *Variables of Interest*
#### **Popular Music Dataset**
* `age`
* `gender`
* `race`


#### ** Illicit Drug Usage Dataset**
* `age`
* `gender`
* `race`
* `police_dept`: the police department responsible for the individual's death
* `year`
* `city`
* `state`
* `criminal_charges`: whether the police officers involved received criminal charges
* `symptoms_of_mental_illness`: whether the individual killed had symptoms of mental illness

&nbsp;


## Exploratory analysis
### Drug Use Data
<br>The prevalence rates of Marijuana use is increasing 
from 1999-2018 at national level in both 18-25 age group and >=26 age group. The 18-25 age group is the highest Marijuana usage group.

```{r marijuana_plot,message=FALSE,warning=FALSE}
songs_abuse%>%
  filter(outcome=="Marijuana use in the past month",area==0)%>%
  group_by(year,agegrp)%>%
  summarize(
  mean_bsae = mean(bsae)
)%>%
  ggplot(aes(x = year, y = mean_bsae)) +
  geom_smooth(aes(color = agegrp), alpha = .5)+
    labs(title = "Mean prevalence rates (%) of Marijuana use by age group",
         y = "Mean prevalence rates of Marijuana use (%) ",
         color = "agegroup")
```

<br>The prevalence rates of illicit drug other than Marijuana is decreasing from 2003-2013 at national level after a peak in 2003-2004 in both 18-25 age group and 12-17 age group.

```{r otherthan_marijuana,message=FALSE, warning=FALSE}
  songs_abuse%>%
  filter(outcome=="Illicit drugs other than marijuana use in the last month",area==0)%>%
  group_by(year,agegrp)%>%
  summarize(
  mean_bsae = mean(bsae)
)%>%
  ggplot(aes(x = year, y = mean_bsae)) +
  geom_smooth(aes(color = agegrp), alpha = .5)+
  labs(title = "Mean prevalence rates (%) of illicit durg other than marijuana by age group",
         y = "Mean prevalence rates (%) of illicit durg other than marijuana",
         color = "agegroup")
```

&nbsp;

```{r message=FALSE,warning=FALSE}
genly = read_csv("./data/genly_billboard.csv", col_names = TRUE) %>%
  mutate(gen_cate = str_remove(gen_cate, "gen_"),
         gen_cate = str_replace(gen_cate,"hiphop", "hip-hop/RnB"),
         lyr_des = as_factor(lyr_des),
         gen_cate = as_factor(gen_cate)) %>%
  select(-lyr_gen)

songs_abuse = read_csv("./data/songs_abuse.csv", col_names = TRUE) %>%
  filter(area == 0) %>%
  mutate(agegrp = as_factor(agegrp),
         outcome = as_factor(outcome)) %>%
  select(-n_lyrics,-total,-stname,-pyearnm)
```
### Popular Music Data
<br>Hip-hop/R&B and rap music are getting popular, while country music and rock music are
getting less hot.

```{r message=FALSE,warning=FALSE}
genly %>%
  filter(lyr_des == "alcohol") %>%
  mutate(text_label = str_c("Genre: ", gen_cate, "\nPopularity: ", round(p_genre, 2), "% \n(95% CI: ",round(p_gen_lci,2),"% - ",round(p_gen_uci,2),"%)")) %>%
  rename("Percentage" = "p_genre") %>%
  plot_ly(
    x = ~ year,
    y = ~ Percentage,
    color = ~ gen_cate,
    text = ~text_label,
    type = "scatter",
    alpha = 0.7
  ) %>%
    add_paths() %>%
    add_ribbons( ymin = ~ p_gen_lci,
                 ymax = ~ p_gen_uci,
                 alpha = 0.3)
```

<br>Generally, substances are more and more often mentioned. Rap music mentioned substances most.
```{r substance, message=FALSE, warning=FALSE}
genly %>%
  filter(gen_cate == "country") %>%
  mutate(text_label = str_c("Substance mentioned: ", lyr_des, "\nPopularity: ", round(p_lyrics, 2), "% \n(95% CI: ",round(p_lyr_lci,2),"% - ",round(p_lyr_uci,2),"%)")) %>%
  rename("Percentage" = "p_lyrics") %>%
  plot_ly(
    x = ~ year,
    y = ~ Percentage,
    color = ~ lyr_des,
    text = ~text_label,
    type = "scatter",
    alpha = 0.7
  ) %>%
    add_paths() %>%
    add_ribbons( ymin = ~ p_lyr_lci,
                 ymax = ~ p_lyr_uci,
                 alpha = 0.3)
```
